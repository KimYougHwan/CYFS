# 编译并部署DIYOOD

在自己的机器上部署一个DIY OOD，可以选择：
1. 使用我们的二进制安装包, 或
2. 从源码编译自己的OOD Service组件，并自行部署

## 使用预编译的二进制安装包
可以从我们的官网[cyfs.com](https://www.cyfs.com)处，下载对应系统的二进制安装包。下载后，直接执行安装包即可。这个安装包会做以下事情：
- 如果是非windows系统，检查libc版本，确保满足我们预编译的二进制要求
- 如果系统未安装node.js，安装node.js的LTS版本。安装包并不会检查已安装的node.js版本
- 如果系统未安装mongodb，安装mongodb 4.4版本
- 如果是非windows系统，且系统未安装docker，安装最新的docker-ce版本
- 从CYFS Core Dev Team所有的Service Repo服务器下载最新的OOD Service文件
- 将OOD Service部署到本地，并启动

## 从源码编译自己的OOD Service组件，并部署

如果不想用预编译的二进制文件，或者你对代码进行了自己的改动，我们也支持自己编译OOD需要的所有组件，并自行部署到任何同系统机器

### 从脚本编译OOD Service
在源码的`src`文件夹下，执行命令`node ../scripts/build-standalone.js`, 这个脚本会编译OOD Service和本地部署需要的工具，并完成本地初步部署。最后生成安装器`ood-installer`

编译前，可以通过`CYFS_BUILD_NUMBER`和`CYFS_BUILD_CHANNEL`两个环境变量，指定版本号和Service使用的通道。Channel的可选值当前只能为`nightly`。默认版本号为0，通道为nightly

编译的具体步骤，可以参考build-standalone.js代码。稍后会添加更详细的说明文档

### 部署OOD Service
编译完成后，会
- 生成`${cyfs_root}/repo_store`目录，这个目录按照一定格式，保存本地编译出来的OOD Service二进制文件。
- 在`src`文件夹下，生成`ood-installer`安装器。

安装前，需要自行准备OOD的依赖环境:
- Node.js LTS版本
- MongoDB 4.4版本，配置开机启动，使用默认端口，无认证
- docker-ce最新版本，配置开机启动

执行命令`./ood-installer --target solo`，就会安装本地编译的二进制作为OOD Service

`${cyfs_root}`具体路径：
- Windows: `c:\cyfs`
- 非Windows: `/cyfs`

将`${cyfs_root}/repo_store`目录，与`ood-installer`程序拷贝到其他相同系统的机器，执行相同命令，可以在其他机器上安装自己编译的OOD Service