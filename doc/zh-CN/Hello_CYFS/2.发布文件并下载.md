# 发布文件到OOD
现在我们拥有了自己的OOD，也拥有了自己的密码学身份，已经做好了全部准备工作，只需将文件上传到OOD就可以构造一个有效的CYFS Object URL了。

这一步需要使用之前用到的cyfs-tool来完成:
```
执行命令`npm i -g cyfs-tool`，安装beta版本的cyfs-tool工具
```

## 通过cyfs-runtime上传文件
现在你在开发机上已经拥有了已经激活的cyfs-runtime(本机上安装了CYFS浏览器([下载页](../Download.md))，并且已经激活过都可以达到该状态),可以通过cyfs-runtime将本机的文件上传到自己的OOD上。
```
使用命令`cyfs upload <file_path>`, 将本地<file_path>指向的文件，上传到OOD上。
```
这个命令还有两个可选参数，在大部分情况下，两个参数都可以省略。这两个参数如下：
- -e <runtime|ood>，指定cyfs tool使用本机的哪个协议栈，默认为`runtime`
- -t <runtime|ood>, 指定要将文件上传到哪个协议栈，默认为`ood`
  
稍待片刻，文件上传成功。此时工具会返回一个以`cyfs://o`开头的链接，这就是我想要的！    
这个链接我们又称作NamedObject Link，它是全网唯一的，将指向你刚刚上传的那个文件。

## 直接添加在OOD上已经存在的文件
如果要上传的文件很大，并且已经保存在OOD上了，我们也可以选择直接在OOD上添加文件到CYFS网络。

通过SSH登录OOD，OOD上也安装了cyfs-tool。然后使用命令`cyfs upload <file_path> -e ood`, 将本地<file_path>指向的文件，添加到OOD。
- -e ood，这个选项表示cyfs tool将使用本机的OOD协议栈，此时该选项不可省略

在OOD上执行这个命令，你可以观察到由于少了上传的步骤，命令执行的速度会快很多。命令执行完毕后，也会生成以`cyfs://o`开头的链接。

**注意**： 这个命令在OOD上执行时是"*标记*"而不是"*上传*"，如果你删除了OOD上的本地文件，这个链接就会失效。在cyfs-runtime所在机器上执行时是"*上传*"，上传完成后可以删除runtime机器上的本地文件。通过cyfs upload命令上传的文件，默认会保存在OOD的/cyfs/data/ 目录下。

# 下载文件
文件上传成功后，生成的对象链接就可以让别人访问。可以在CYFS浏览器中直接打开查看，也可以通过`cyfs-tool`来下载。

使用命令`cyfs get {cyfs://} -s <save_path>`，可以将文件通过cyfs-runtime协议栈下载到本地
- 如果想使用OOD协议栈下载，要在OOD上执行该命令，并且加上-e ood参数。

存储逻辑：
- 如果save_path是一个不存在的文件路径，则：
  - 如果cyfs链接指向一个目录，则目录中的所有内容会被下载到save_path目录
  - 如果cyfs链接指向一个文件，或一个目录中的子文件，该文件会被下载到save_path文件
  - 如果cyfs链接指向的是一个子目录, 子目录里的内容会被下载到save_path目录下
- 如果save_path是一个已存在的目录，则：
  - 如果cyfs链接指向一个目录，则目录的所有内容会被下载到save_path/{objectid}目录
  - 如果cyfs链接指向一个文件，则文件会被下载到save_path/{fileid.file}文件
  - 如果cyfs链接指向的是一个子目录，或子文件，指向的内容会被下载到save_path/{子目录名或子文件名}

当在runtime上下载时，由于是点对点的传输，这个runtime对应的OOD上是不会缓存这个数据的。

# TODO:LZC 一点点原理解释：有主命名对象,NON,NDN
进一步理解cyfs://o 在OOD上上传一个已经下回来的文件
更换$ownerid后，依旧可以访问。
对File Object进行 Dump 
对OOD上的文件进行修改，你会发现get命令失败了。因为校验失败了

# 为什么cyfs不需要TLS
我们的CYFS身份相当于内嵌了一个自签名证书，从这个角度看，BDT协议天生就是TLS支持的

# Zone
这里有一个比较深层的概念：Zone。在简单的使用中，我们可能很少接触到这个概念，但随着学习的深入，Zone这个概念会出现得越来越频繁。

简单来说，Zone是一组相同Owner的Device的集合。在上边的章节中，我们用超送，或者用cyfs-tool激活了一个OOD和一个runtime，由于OOD和runtime设备的owner都是同一个PeopleId，那么它们就组成了一个Zone。Zone是一个小型的星形中心化组织，OOD是这个星形的中心。任何设备想访问另外一个Zone，都必须先经过自己的OOD，去访问对方Zone的OOD。CYFS协议禁止了直接对另一个Zone内非OOD设备的直接访问

# 小结
恭喜！到这里你已经完成了CYFS第一个阶段的学习！虽然内容非常简单，但你已经通过CYFS Object URL，实践了Web3给人们带来的一项重要基础权利:“每个人都拥有在互联网上保存内容和发布内容的权利”。只要CYFS Object URL的Owner愿意，这个Link就永远可以被打开，而从使用者的角度来看，这是一个指向不会被篡改内容的可信URL。





