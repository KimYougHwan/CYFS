# 发布文件到OOD
现在我们拥有了自己的OOD，也拥有了自己的密码学身份，已经做好了全部准备工作，只需将文件上传到OOD就可以构造一个有效的CYFS Object URL了。

这一步需要使用之前用到的cyfs-tool来完成:
```
执行命令`npm i -g cyfs-tool`，安装beta版本的cyfs-tool工具
```

## 通过cyfs-runtime上传文件
现在你在开发机上已经拥有了已经激活的cyfs-runtime(本机上安装了CYFS浏览器([下载页](../Download.md))，并且已经激活过都可以达到该状态),可以通过cyfs-runtime将本机的文件上传到自己的OOD上。
```
使用命令`cyfs upload <file_path>`, 将本地<file_path>指向的文件，上传到OOD上。
```
这个命令还有两个可选参数，在大部分情况下，两个参数都可以省略。这两个参数如下：
- -e <runtime|ood>，指定cyfs tool使用本机的哪个协议栈，默认为`runtime`
- -t <runtime|ood>, 指定要将文件上传到哪个协议栈，默认为`ood`
  
稍待片刻，文件上传成功。此时工具会返回一个以`cyfs://o`开头的链接，这就是我想要的！    
这个链接我们又称作NamedObject Link，它是全网唯一的，将指向你刚刚上传的那个文件。

## 直接添加在OOD上已经存在的文件
如果要上传的文件很大，并且已经保存在OOD上了，我们也可以选择直接在OOD上添加文件到CYFS网络。

通过SSH登录OOD，OOD上也安装了cyfs-tool。然后使用命令`cyfs upload <file_path> -e ood`, 将本地<file_path>指向的文件，添加到OOD。
- -e ood，这个选项表示cyfs tool将使用本机的OOD协议栈，此时该选项不可省略

在OOD上执行这个命令，你可以观察到由于少了上传的步骤，命令执行的速度会快很多。命令执行完毕后，也会生成以`cyfs://o`开头的链接。

**注意**： 这个命令在OOD上执行时是"*标记*"而不是"*上传*"，如果你删除了OOD上的本地文件，这个链接就会失效。在cyfs-runtime所在机器上执行时是"*上传*"，上传完成后可以删除runtime机器上的本地文件。通过cyfs upload命令上传的文件，默认会保存在OOD的/cyfs/data/ 目录下。

# 下载文件
文件上传成功后，生成的对象链接就可以让别人访问。可以在CYFS浏览器中直接打开查看，也可以通过`cyfs-tool`来下载。

使用命令`cyfs get {cyfs://} -s <save_path>`，可以将文件通过cyfs-runtime协议栈下载到本地
- 如果想使用OOD协议栈下载，要在OOD上执行该命令，并且加上-e ood参数。

存储逻辑：
- 如果save_path是一个不存在的文件路径，则：
  - 如果cyfs链接指向一个目录，则目录中的所有内容会被下载到save_path目录
  - 如果cyfs链接指向一个文件，或一个目录中的子文件，该文件会被下载到save_path文件
  - 如果cyfs链接指向的是一个子目录, 子目录里的内容会被下载到save_path目录下
- 如果save_path是一个已存在的目录，则：
  - 如果cyfs链接指向一个目录，则目录的所有内容会被下载到save_path/{objectid}目录
  - 如果cyfs链接指向一个文件，则文件会被下载到save_path/{fileid.file}文件
  - 如果cyfs链接指向的是一个子目录，或子文件，指向的内容会被下载到save_path/{子目录名或子文件名}

TODO：使用runtime下载，会不会在OOD上也缓存一份？Zone内的另一个设备再下载的时候，是不会产生跨Zone浏览了。（理解OOD是一个Zone内的Cache中心，是浏览器缓存的前置）

# TODO:LZC 一点点原理解释：有主命名对象,NON,NDN 
进一步理解cyfs://o 在OOD上上传一个已经下回来的文件
更换$ownerid后，依旧可以访问。
对File Object进行 Dump 
对OOD上的文件进行修改，你会发现get命令失败了。因为校验失败了


#### 2. people和 device上链, 如果之前上链过，则跳过这一步
cyfs meta putdesc -c  C:\Users\Bucky\.cyfs_profile\People
cyfs meta putdesc -c C:\cyfs\etc\desc\device
## 输出如 `create/update desc 5hLXAcPC78hJVrQ95djNBJzv75p3ACUAHTB2xtRvz6bZ success, txhash 8YCfQUGt6wbV7kb7iRXhHGiJf8DXnyktaFaNTQWTYg3G`

### 3. 查看deivce上链状态, txhash 上一步中的txhash, 返回ret: 0 表示成功
cyfs meta receipt 8YCfQUGt6wbV7kb7iRXhHGiJf8DXnyktaFaNTQWTYg3G

# 通过MetaChain查询Zone信息，并理解寻地址（为什么cyfs不需要TLS）
TODO: MetaChain上没有zone信息，zone信息只在协议栈上
TODO：寻址是通过DeviceId找到IP？目前是依赖SN的功能实现的

我们的CYFS身份相当于内嵌了一个自签名证书，从这个角度看，BDT协议天生就是TLS支持的

# TODO：进一步讲解一点Zone的概念

# 小结
恭喜！到这里你已经完成了CYFS第一个阶段的学习！虽然内容非常简单，但你已经通过CYFS Object URL，实践了Web3给人们带来的一项重要基础权利:“每个人都拥有在互联网上保存内容和发布内容的权利”。只要CYFS Object URL的Owner愿意，这个Link就永远可以被打开，而从使用者的角度来看，这是一个指向不会被篡改内容的可信URL。





